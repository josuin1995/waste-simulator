<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>íê¸°ë¬¼ì²˜ë¶„ë¶€ë‹´ê¸ˆ ì‚¬ì „ ê³„ì‚° ë° ì¬í™œìš©ì— ë”°ë¥¸ ê°€ì¹˜ í™˜ì‚°</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body class="bg-gray-100 text-gray-800">
  <header class="bg-green-700 text-white p-4 text-center">
    <img src="templates/keco_logo.png" alt="í•œêµ­í™˜ê²½ê³µë‹¨ ë¡œê³ " class="mx-auto h-12">
    <h1 class="text-xl font-bold mt-2">íê¸°ë¬¼ì²˜ë¶„ë¶€ë‹´ê¸ˆ ì‚¬ì „ ê³„ì‚° ë° ì¬í™œìš©ì— ë”°ë¥¸ ê°€ì¹˜ í™˜ì‚°</h1>
  </header>

  <main class="max-w-2xl mx-auto p-4 bg-white shadow-lg rounded-lg mt-6">
    <div class="space-y-4">
      <div>
        <label class="block font-semibold">íê¸°ë¬¼ ìœ í˜•</label>
        <select id="wasteCategory" onchange="updateOptions()" class="w-full border rounded px-3 py-2">
          <option value="business">ì‚¬ì—…ì¥íê¸°ë¬¼</option>
          <option value="construction">ê±´ì„¤íê¸°ë¬¼</option>
        </select>
      </div>

      <div>
        <label class="block font-semibold">ì²˜ë¦¬ ë°©ì‹</label>
        <select id="disposalMethod" class="w-full border rounded px-3 py-2">
          <option value="incineration">ì†Œê°</option>
          <option value="landfill">ë§¤ë¦½</option>
        </select>
      </div>

      <div id="wasteTypeContainer">
        <label class="block font-semibold">íê¸°ë¬¼ íŠ¹ì„± (ì‚¬ì—…ì¥íê¸°ë¬¼ë§Œ í•´ë‹¹)</label>
        <select id="wasteType" class="w-full border rounded px-3 py-2">
          <option value="combustible">ê°€ì—°ì„±</option>
          <option value="non_combustible">ë¶ˆì—°ì„±</option>
        </select>
      </div>

      <div>
        <label class="block font-semibold">ì²˜ë¶„ë…„ë„</label>
        <select id="disposalYear" class="w-full border rounded px-3 py-2">
          <option value="2018">2018</option>
          <option value="2019">2019</option>
          <option value="2020">2020</option>
          <option value="2021">2021</option>
          <option value="2022">2022</option>
          <option value="2023">2023</option>
          <option value="2024" selected>2024</option>
          <option value="2025">2025</option>
        </select>
      </div>

      <div>
        <label class="block font-semibold">ë°°ì¶œëŸ‰ (kg)</label>
        <input type="number" id="wasteAmount" class="w-full border rounded px-3 py-2" placeholder="ì˜ˆ: 100" />
      </div>

      <button onclick="calculate()" class="w-full bg-green-600 hover:bg-green-700 text-white py-2 rounded font-semibold">ë¹„ìš© ê³„ì‚°</button>

      <div id="result" class="p-4 bg-gray-50 border rounded text-sm"></div>

      <div class="mt-6">
        <canvas id="costChart"></canvas>
      </div>
    </div>
  </main>

  <script>
    let chart;
    const rateIndex = {
      2018: 1, 2019: 1.019, 2020: 1.023, 2021: 1.024,
      2022: 1.059, 2023: 1.132, 2024: 1.168, 2025: 1.192
    };

    function updateOptions() {
      const category = document.getElementById("wasteCategory").value;
      const wasteTypeContainer = document.getElementById("wasteTypeContainer");
      wasteTypeContainer.style.display = category === "business" ? "block" : "none";
    }

    function calculate() {
      const category = document.getElementById("wasteCategory").value;
      const disposalMethod = document.getElementById("disposalMethod").value;
      const wasteType = document.getElementById("wasteType").value;
      const disposalYear = document.getElementById("disposalYear").value;
      const wasteAmount = parseFloat(document.getElementById("wasteAmount").value);
      if (isNaN(wasteAmount) || wasteAmount <= 0) {
        alert("ìœ íš¨í•œ ë°°ì¶œëŸ‰(kg)ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.");
        return;
      }

      const index = rateIndex[disposalYear];
      let rate = 0;
      if (category === 'business') {
        if (disposalMethod === 'incineration') rate = 10;
        else if (disposalMethod === 'landfill') rate = (wasteType === 'combustible') ? 25 : 10;
      } else if (category === 'construction') {
        rate = (disposalMethod === 'incineration') ? 10 : 30;
      }

      const fee = wasteAmount * rate * index;
      const recycleCost = wasteAmount * 20;
      const carbonReduction = wasteAmount * 1.5;
      const jobCreation = (wasteAmount / 1000) * 0.1;
      const environmentValue = wasteAmount * 30;

      document.getElementById("result").innerHTML =
        `<strong>íê¸°ë¬¼ì²˜ë¶„ë¶€ë‹´ê¸ˆ:</strong> ${Math.round(fee).toLocaleString()}ì›<br>` +
        `<strong>ì¬í™œìš© ë¹„ìš©:</strong> ${Math.round(recycleCost).toLocaleString()}ì›<br>` +
        `<strong>ğŸŒ ì˜¨ì‹¤ê°€ìŠ¤ ì ˆê°:</strong> ${carbonReduction.toLocaleString()}kg COâ‚‚<br>` +
        `<strong>ğŸ‘· ì¼ìë¦¬ ì°½ì¶œ:</strong> ${jobCreation.toFixed(3)} ëª…<br>` +
        `<strong>ğŸŒ± í™˜ê²½ë³´ì „ ê°€ì¹˜:</strong> ${environmentValue.toLocaleString()}ì›`;

      updateChart(fee, environmentValue);
    }

    function updateChart(fee, benefit) {
      const ctx = document.getElementById("costChart").getContext("2d");
      if (chart) chart.destroy();
      chart = new Chart(ctx, {
        type: "bar",
        data: {
          labels: ["íê¸°ë¬¼ì²˜ë¶„ë¶€ë‹´ê¸ˆ", "í™˜ê²½ í¸ìµ"],
          datasets: [{
            label: "ë¹„ìš©/í¸ìµ (ì›)",
            data: [fee, benefit],
            backgroundColor: ["#f87171", "#34d399"]
          }]
        },
        options: {
          responsive: true,
          plugins: {
            legend: { display: false },
            tooltip: {
              callbacks: {
                label: context => `${context.dataset.label}: ${Math.round(context.raw).toLocaleString()}ì›`
              }
            }
          },
          scales: {
            y: {
              beginAtZero: true,
              ticks: {
                callback: value => `${value.toLocaleString()}ì›`
              }
            }
          }
        }
      });
    }

    window.onload = updateOptions;
  </script>
</body>
</html>